@model SmartGuardPortalv1.Models.ContactSchedule

@{
    ViewBag.Title = "Edit";
    int userId = (int)WebSecurity.CurrentUserId;

    var daysType = new List<SelectListItem> 
    { 
              new SelectListItem { Text = "Sunday", Value = "SUN" }, 
              new SelectListItem { Text = "Monday", Value = "MON" },
              new SelectListItem { Text = "Tuesday", Value = "TUE" }, 
              new SelectListItem { Text = "Wednesday", Value = "WED" },
              new SelectListItem { Text = "Thursday", Value = "THU" }, 
              new SelectListItem { Text = "Friday", Value = "FRI" },
              new SelectListItem { Text = "Saturday", Value = "SAT" }
           
              //new SelectListItem { Text = "", Value = "2" }, 
            
    };

    var hoursType = new List<SelectListItem>
    {
              new SelectListItem { Text = "0", Value = "0" },
              new SelectListItem { Text = "1", Value = "1" }, 
              new SelectListItem { Text = "2", Value = "2" },
              new SelectListItem { Text = "3", Value = "3" }, 
              new SelectListItem { Text = "4", Value = "4" },
              new SelectListItem { Text = "5", Value = "5" }, 
              new SelectListItem { Text = "6", Value = "6" },
              new SelectListItem { Text = "7", Value = "7" },
              new SelectListItem { Text = "8", Value = "8" }, 
              new SelectListItem { Text = "9", Value = "9" },
              new SelectListItem { Text = "10", Value = "10" }, 
              new SelectListItem { Text = "11", Value = "11" },
              new SelectListItem { Text = "12", Value = "12" }, 
              new SelectListItem { Text = "13", Value = "13" },
              new SelectListItem { Text = "14", Value = "14" },
              new SelectListItem { Text = "15", Value = "15" }, 
              new SelectListItem { Text = "16", Value = "16" },
              new SelectListItem { Text = "17", Value = "17" }, 
              new SelectListItem { Text = "18", Value = "18" },
              new SelectListItem { Text = "19", Value = "19" }, 
              new SelectListItem { Text = "20", Value = "20" },
              new SelectListItem { Text = "21", Value = "21" },
              new SelectListItem { Text = "22", Value = "22" }, 
              new SelectListItem { Text = "23", Value = "23" }
           
    };

    var minsTensType = new List<SelectListItem>
    {
              new SelectListItem { Text = "0", Value = "0" }, 
              new SelectListItem { Text = "1", Value = "1" },
              new SelectListItem { Text = "2", Value = "2" }, 
              new SelectListItem { Text = "3", Value = "3" },
              new SelectListItem { Text = "4", Value = "4" },
              new SelectListItem { Text = "5", Value = "5" }
    };

    var minsOnesType = new List<SelectListItem>
    {
              new SelectListItem { Text = "0", Value = "0" }, 
              new SelectListItem { Text = "1", Value = "1" },
              new SelectListItem { Text = "2", Value = "2" }, 
              new SelectListItem { Text = "3", Value = "3" },
              new SelectListItem { Text = "4", Value = "4" },
              new SelectListItem { Text = "5", Value = "5" },
              new SelectListItem { Text = "6", Value = "6" },
              new SelectListItem { Text = "7", Value = "7" }, 
              new SelectListItem { Text = "8", Value = "8" },
              new SelectListItem { Text = "9", Value = "9" }
          
    };
}

<script type="text/javascript">
    window.onload = function () {
        var savedSched = "@Model.ContactSchedules";
        var parsedSched = savedSched.split(',');
        for (i = 0; i < parsedSched.length; i++) {
            var schedContent = parsedSched[i].split(' ');
            if (schedContent[0] == 'SUN')
            {
                var sched = document.getElementById("SunSched");
                var element = document.createElement("input");

                element.type = "button";
                element.value = parsedSched[i];
                element.id = element.value;
                sched.appendChild(element);

                element.onclick = function () { // Note this is a function
                    //alert("Delete?");


                    if (confirm("Do you want to delete?") == true) {
                        //element.parentNode.removeChile(element);
                        document.getElementById(this.id).remove();

                    } else {

                    }
                };
            }
            else if (schedContent[0] == 'MON') {
                var sched = document.getElementById("MonSched");
                var element = document.createElement("input");

                element.type = "button";
                element.value = parsedSched[i];
                element.id = element.value;
                sched.appendChild(element);

                element.onclick = function () { // Note this is a function
                    //alert("Delete?");


                    if (confirm("Do you want to delete?") == true) {
                        //element.parentNode.removeChile(element);
                        document.getElementById(this.id).remove();

                    } else {

                    }
                };
            }
            else if (schedContent[0] == 'TUE') {
                var sched = document.getElementById("TueSched");
                var element = document.createElement("input");

                element.type = "button";
                element.value = parsedSched[i];
                element.id = element.value;
                sched.appendChild(element);

                element.onclick = function () { // Note this is a function
                    //alert("Delete?");


                    if (confirm("Do you want to delete?") == true) {
                        //element.parentNode.removeChile(element);
                        document.getElementById(this.id).remove();

                    } else {

                    }
                };
            }
            else if (schedContent[0] == 'WED') {
                var sched = document.getElementById("WedSched");
                var element = document.createElement("input");

                element.type = "button";
                element.value = parsedSched[i];
                element.id = element.value;
                sched.appendChild(element);

                element.onclick = function () { // Note this is a function
                    //alert("Delete?");


                    if (confirm("Do you want to delete?") == true) {
                        //element.parentNode.removeChile(element);
                        document.getElementById(this.id).remove();

                    } else {

                    }
                };
            }
            else if (schedContent[0] == 'THU') {
                var sched = document.getElementById("ThuSched");
                var element = document.createElement("input");

                element.type = "button";
                element.value = parsedSched[i];
                element.id = element.value;
                sched.appendChild(element);

                element.onclick = function () { // Note this is a function
                    //alert("Delete?");


                    if (confirm("Do you want to delete?") == true) {
                        //element.parentNode.removeChile(element);
                        document.getElementById(this.id).remove();

                    } else {

                    }
                };
            }
            else if (schedContent[0] == 'FRI') {
                var sched = document.getElementById("FriSched");
                var element = document.createElement("input");

                element.type = "button";
                element.value = parsedSched[i];
                element.id = element.value;
                sched.appendChild(element);

                element.onclick = function () { // Note this is a function
                    //alert("Delete?");


                    if (confirm("Do you want to delete?") == true) {
                        //element.parentNode.removeChile(element);
                        document.getElementById(this.id).remove();

                    } else {

                    }
                };
            }
            else if (schedContent[0] == 'SAT') {
                var sched = document.getElementById("SatSched");
                var element = document.createElement("input");

                element.type = "button";
                element.value = parsedSched[i];
                element.id = element.value;
                sched.appendChild(element);

                element.onclick = function () { // Note this is a function
                    //alert("Delete?");


                    if (confirm("Do you want to delete?") == true) {
                        //element.parentNode.removeChile(element);
                        document.getElementById(this.id).remove();

                    } else {

                    }
                };
            }
        }
    }

    function submitForm() {
        var strSched = "";
        
        var Sched = document.getElementById("SunSched");
        var childSched;
        for (i = 0; i < Sched.childNodes.length; i++) {
            childSched = Sched.childNodes[i];
            //allDates.concat(childDate.id, ",");
            if (childSched.value != null) {
                //alert(childSched.value);
                strSched += childSched.value + ",";
            }
            //allDates = childDate.id;
        }

        Sched = document.getElementById("MonSched");
        for (i = 0; i < Sched.childNodes.length; i++) {
            childSched = Sched.childNodes[i];
            //allDates.concat(childDate.id, ",");
            if (childSched.value != null) {
                //alert(childSched.value);
                strSched += childSched.value + ",";
            }
            //allDates = childDate.id;
        }
        Sched = document.getElementById("TueSched");
        for (i = 0; i < Sched.childNodes.length; i++) {
            childSched = Sched.childNodes[i];
            //allDates.concat(childDate.id, ",");
            if (childSched.value != null) {
                //alert(childSched.value);
                strSched += childSched.value + ",";
            }
            //allDates = childDate.id;
        }
        Sched = document.getElementById("WedSched");
        for (i = 0; i < Sched.childNodes.length; i++) {
            childSched = Sched.childNodes[i];
            //allDates.concat(childDate.id, ",");
            if (childSched.value != null) {
                //alert(childSched.value);
                strSched += childSched.value + ",";
            }
            //allDates = childDate.id;
        }
        Sched = document.getElementById("ThuSched");
        for (i = 0; i < Sched.childNodes.length; i++) {
            childSched = Sched.childNodes[i];
            //allDates.concat(childDate.id, ",");
            if (childSched.value != null) {
                //alert(childSched.value);
                strSched += childSched.value + ",";
            }
            //allDates = childDate.id;
        }
        Sched = document.getElementById("FriSched");
        for (i = 0; i < Sched.childNodes.length; i++) {
            childSched = Sched.childNodes[i];
            //allDates.concat(childDate.id, ",");
            if (childSched.value != null) {
                //alert(childSched.value);
                strSched += childSched.value + ",";
            }
            //allDates = childDate.id;
        }
        Sched = document.getElementById("SatSched");
        for (i = 0; i < Sched.childNodes.length; i++) {
            childSched = Sched.childNodes[i];
            //allDates.concat(childDate.id, ",");
            if (childSched.value != null) {
                //alert(childSched.value);
                strSched += childSched.value + ",";
            }
            //allDates = childDate.id;
        }

        document.getElementById("ContactSchedules").value = strSched;
        document.getElementById("contactSchedulesForm").submit();
    }

    function parseSchedule()
    {
        var br = document.createElement("br");
        var day = document.getElementById("dayType").value;
        var startHr = document.getElementById("startHourType").value;
        var startMinTens = document.getElementById("startMinTensType").value;
        var startMinOnes = document.getElementById("startMinOnesType").value;
        var endHr = document.getElementById("endHourType").value;
        var endMinTens = document.getElementById("endMinTensType").value;
        var endMinOnes = document.getElementById("endMinOnesType").value;

        if (startHr > endHr)
        {
            alert("Invalid schedule");
            return;
        }
        else if (startHr == endHr)
        {
            if (startMinTens > endMinTens)
            {
                alert("Invalid schedule");
                return;
            }
            else if (startMinTens == endMinTens)
            {
                if(startMinOnes >= endMinOnes)
                {
                    alert("Invalid schedule");
                    return;
                }
            }
                
        }

        if (day == 'SUN') {
            var Sched = document.getElementById("SunSched");
            var element = document.createElement("input");
            
            element.type = "button";
            element.value = 'SUN ' + startHr + ":" + startMinTens + startMinOnes + "-" + endHr + ":" + endMinTens + endMinOnes;
            element.id = element.value;
            Sched.appendChild(element);
            Sched.appendChild(br);
        }
        else if (day == 'MON') {
            var Sched = document.getElementById("MonSched");
            var element = document.createElement("input");

            element.type = "button";
            element.value = 'MON ' + startHr + ":" + startMinTens + startMinOnes + "-" + endHr + ":" + endMinTens + endMinOnes;
            element.id = element.value;
            Sched.appendChild(element);
            Sched.appendChild(br);
        }
        else if (day == 'TUE') {
            var Sched = document.getElementById("TueSched");
            var element = document.createElement("input");

            element.type = "button";
            element.value = 'TUE ' + startHr + ":" + startMinTens + startMinOnes + "-" + endHr + ":" + endMinTens + endMinOnes;
            element.id = element.value;
            Sched.appendChild(element);
            Sched.appendChild(br);
        }
        else if (day == 'WED') {
            var Sched = document.getElementById("WedSched");
            var element = document.createElement("input");

            element.type = "button";
            element.value = 'WED ' + startHr + ":" + startMinTens + startMinOnes + "-" + endHr + ":" + endMinTens + endMinOnes;
            element.id = element.value;
            Sched.appendChild(element);
            Sched.appendChild(br);
        }
        else if (day == 'THU') {
            var Sched = document.getElementById("ThuSched");
            var element = document.createElement("input");

            element.type = "button";
            element.value = 'THU ' + startHr + ":" + startMinTens + startMinOnes + "-" + endHr + ":" + endMinTens + endMinOnes;
            element.id = element.value;
            Sched.appendChild(element);
            Sched.appendChild(br);
        }
        else if (day == 'FRI') {
            var Sched = document.getElementById("FriSched");
            var element = document.createElement("input");

            element.type = "button";
            element.value = 'FRI ' + startHr + ":" + startMinTens + startMinOnes + "-" + endHr + ":" + endMinTens + endMinOnes;
            element.id = element.value;
            Sched.appendChild(element);
            Sched.appendChild(br);
        }
        else if (day == 'SAT') {
            var Sched = document.getElementById("SatSched");
            var element = document.createElement("input");

            element.type = "button";
            element.value = 'SAT ' + startHr + ":" + startMinTens + startMinOnes + "-" + endHr + ":" + endMinTens + endMinOnes;
            element.id = element.value;
            Sched.appendChild(element);
            Sched.appendChild(br);
        }

        element.onclick = function () { // Note this is a function
            //alert("Delete?");
            
            
            if (confirm("Do you want to delete?") == true) {
                //element.parentNode.removeChile(element);
                document.getElementById(element.id).remove();
                
            } else {

            }
        };
    }
</script>

<b>@Html.ActionLink("Account Information", "Profile", "Account") > Edit Contact Schedules</b>
<br />
<table>
    <tr>
        <td>Day</td>
        <td>Start time</td>
        <td>End time</td>
    </tr>
    <tr>
        <td>@Html.DropDownList("dayType",  new SelectList(daysType , "Value" , "Text"))</td>
        <td>
            @Html.DropDownList("startHourType",  new SelectList(hoursType , "Value" , "Text")):
            @Html.DropDownList("startMinTensType",  new SelectList(minsTensType , "Value" , "Text"))
            @Html.DropDownList("startMinOnesType",  new SelectList(minsOnesType , "Value" , "Text"))
        </td>
        <td>
            @Html.DropDownList("endHourType",  new SelectList(hoursType , "Value" , "Text")):
            @Html.DropDownList("endMinTensType",  new SelectList(minsTensType , "Value" , "Text"))
            @Html.DropDownList("endMinOnesType",  new SelectList(minsOnesType , "Value" , "Text"))
        </td>
        
    </tr>
</table>
<input type="button" value="Add Schedule" onclick="parseSchedule()"/>

<br />
<table>
    <tr>
        <td>Sunday</td>
        <td>Monday</td>
        <td>Tuesday</td>
        <td>Wednesday</td>
        <td>Thursday</td>
        <td>Friday</td>
        <td>Saturday</td>
    </tr>
    <tr id="WeekSched" valign="top">
        <td id="SunSched"></td>
        <td id="MonSched"></td>
        <td id="TueSched"></td>
        <td id="WedSched"></td>
        <td id="ThuSched"></td>
        <td id="FriSched"></td>
        <td id="SatSched"></td>
    </tr>
</table>

@using ((Html.BeginForm(null, null, FormMethod.Post, new { id = "contactSchedulesForm" })))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>Contact Schedules</legend>

        @Html.HiddenFor(model => model.ContactScheduleId)
        @Html.HiddenFor(model => model.ContactSchedules)

        <input type="hidden" value="@userId" id="fkUserId" name="fkUserId"/>
        @Html.CheckBoxFor(m => m.canContactOutsideSched) Can contact outside schedule?

        <p>
            <input type="button" value="Save" onclick="submitForm()" />
        </p>
    </fieldset>
}



@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
